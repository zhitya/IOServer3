# ---------------- TELEGRAF CORE ---------------
[agent]
  interval = "10s"
  flush_interval = "10s"
  round_interval = true
  omit_hostname = true

[[inputs.modbus]]
  name = "modbus"
  controller = "tcp://host.docker.internal:502"   # ваш IP
  slave_id = 1
  timeout = "2s"

  [inputs.modbus.tags]
    device_id = "meter1"

  [[inputs.modbus.holding_registers]]
    name = "Voltage_L1"
    data_type = "UINT16"
    byte_order = "AB"
    scale = 1.0
    address = [0]        # <-- масив, НЕ число

  [[inputs.modbus.holding_registers]]
    name = "Current_L1"
    data_type = "UINT16"
    byte_order = "AB"
    scale = 1.0
    address = [1]

# Приклад 32-бітового значення (за потреби)
# [[inputs.modbus.holding_registers]]
#   name = "Power_Total"
#   data_type = "FLOAT32-IEEE"
#   byte_order = "ABCD"
#   scale = 1.0
#   address = [52, 53]

[[outputs.sql]]
  driver = "pgx"
  data_source_name = "postgres://telegraf:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:5432/${POSTGRES_DB}?sslmode=disable"

